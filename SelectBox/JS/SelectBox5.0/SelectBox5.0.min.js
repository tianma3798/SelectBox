(function(){var g=function(j,k){this.elem=j;var i={width:150,panelWidth:"auto",panelHeight:"auto",data:[],selectedData:[],placeHolder:"",valueTarget:"",showClearBtn:true,clearBtnText:"清空",moreSelect:true,overShow:true,autoShow:false,showAllName:true,allLevelSelect:false,levelTwoSelect:true,showResult:true,resetStyle:true,onClose:function(l,m){},onShow:function(){},onClear:function(){},onSelect:function(l,m){},maxSize:undefined,level:1};if(typeof k.data==="string"){k.data=$.evalJSON(k.data)}if(typeof k.selectedData==="string"){k.selectedData=$.evalJSON(k.selectedData)}else{if(k.selectedData==undefined){k.selectedData=[]}}k.selectedData=f(k.data,k.selectedData,k.level);this.opts=$.extend({},i,k)};function h(i){alert(i)}function f(n,p,v){var w=[];for(var o=0;o<n.length;o++){var r=n[o];if(b(r.id,p)){w.push(r)}var l=r.children;if(v==1||l==undefined||l.length<=0){continue}for(var t=0;t<l.length;t++){var s=l[t];if(b(s.id,p)&&v==2){w.push(s)}var m=s.children;if(v==2||m==undefined||m.length<=0){continue}for(var u=0;u<m.length;u++){var q=m[u];if(b(q.id,p)){w.push(q)}}}}return w}function b(k,l){for(var j=0;j<l.length;j++){var m=l[j];if(m==k){return true}}return false}function c(j,m){for(var k=0;k<m.length;k++){var l=m[k];if(l.id==j.id){return true}}return false}g.prototype={init:function(){var k=this;var i=this.elem;var j=this.opts;if(j.resetStyle){l()}if(j.autoShow){k.showPanel()}$(window).resize(function(){k.setPanelSite()});i.click(function(){k.showPanel();$(window.document).on("click",{obj:k},a);return false});i.parents().each(function(){var n=$(this);var m=n.css("overflow");if(m=="auto"||m=="scroll"){n.scroll(function(){k.setPanelSite()});return false}});function l(){i.empty();var m=e("selectResult");i.append(m);i.append(e("selectIcon"));i.append(d());i.css({width:j.width});m.css({width:j.width-30});k.showResult();k.showPlaceHolder()}},showPlaceHolder:function(){var j=this;var i=j.opts;var k=j.elem.find(".selectResult");if(i.selectedData.length<=0&&i.placeHolder.length>0){k.addClass("placeHolder");k.text(i.placeHolder)}},createContainer:function(){var k=this;var i=this.elem;var j=this.opts;$(".selectBoxConter").remove();var m=e("selectBoxConter");var n="";if(j.level==1){n=k.getPanelOne()}else{if(j.level==2){n=k.getPanelTwo()}else{n=k.getPanelThree()}}m.append(n);i.append(m);k.setPanelSite();j.onShow();m.fadeIn("fast");if(j.showClearBtn){var l=e("clearBtn");l.text(j.clearBtnText);l.click(function(){j.onClear();k.clearData();k.showResult();k.destroyPanel()});m.append(l)}if(j.moreSelect){m.addClass("moreSelect");var o=e("yesBtn");o.text("确定");o.click(function(){k.destroyPanel()});m.append(o)}return m},setPanelSite:function(){var k=this;var i=this.elem;var j=this.opts;var l=$(".selectBoxConter");l.css({marginTop:2,width:j.panelWidth=="auto"?i.width():j.panelWidth}).click(function(){return false});if(j.panelHeight!="auto"){l.css({height:j.panelHeight})}},getPanelOne:function(){var j=this;var i=this.opts;var k=i.data;var m=e("selectBoxPanel panelSelectd");var l=j.getPanelByData(k);m.append(l);return m},getPanelTwo:function(){var j=this;var i=this.opts;var k=i.data;return j.getPanelTwoByData(k).show()},getPanelTwoByData:function(l){var j=this;var p=e("selectBoxPanel");for(var m=0;m<l.length;m++){var n=l[m];var o=e("secondLine");o.appendTo(p);var r=e("secondTop");var s=e("selectTopItem");s.text(n.text);s.attr("data-id",n.id);if(j.opts.moreSelect==false){if(j.opts.allLevelSelect){var q={id:s.attr("data-id"),text:s.text()};s.addClass("enable");if(j.isExists(q)){s.addClass("selected")}s.click(function(){var i=$(this);j.clearData();j.appendByItem(i);j.destroyPanel();j.opts.onSelect({id:i.attr("data-id"),text:i.text()},j.getDataID())})}}r.append(s);r.append('<div class="clear"></div>');r.appendTo(o);var k=e("secondContent");k.append(j.getPanelByData(n.children));k.appendTo(o);o.append(e("clear"))}return p},getPanelThree:function(){var k=this;var j=this.opts;var m=j.data;var o=e("inner");var r=e("tabDiv");r.appendTo(o);for(var n=0;n<m.length;n++){var p=m[n];var s=e("tabItem");s.text(p.text);s.appendTo(r)}r.children().first().addClass("tabSelectItem");r.append(d());for(var n=0;n<m.length;n++){var l=m[n].children;k.getPanelTwoByData(l).appendTo(o)}o.find(".selectBoxPanel").first().addClass("panelSelectd");var t=o.find(".tabItem");var q=o.find(".selectBoxPanel");t.mouseenter(function(){var u=$(this);u.addClass("tabSelectItem").siblings().removeClass("tabSelectItem");var i=t.index(u);q.eq(i).show().siblings(".selectBoxPanel ").hide()});return o},getPanelByData:function(l){var k=this;var j=this.opts;var p=e("innerList");for(var n=0;n<l.length;n++){var o=l[n];var m=e("selectBoxItem");m.attr("data-id",o.id);m.append("<span>"+o.text+"</span>").append("<i></i>");m.click(function(){var q=$(this);var i={id:q.attr("data-id"),text:q.text()};if(j.moreSelect==true){if(q.hasClass("selected")){k.removeData(i);q.removeClass("selected")}else{k.appendByItem(q)}}else{k.clearData();k.appendByItem(q);k.destroyPanel()}j.onSelect(i,k.getDataID())});p.append(m)}p.append(d());return p},appendByItem:function(k){var j=this;var i=this.opts;if(i.maxSize){if(j.getDataCount()>=i.maxSize){h("选中结果不可以超过"+i.maxSize+"个");return}}var l={id:k.attr("data-id"),text:k.text()};k.addClass("selected");j.appendData(l)},appendData:function(l){var j=this;var i=this.opts;var k=i.selectedData;k.push(l);j.showResult()},removeData:function(o){var k=this;var j=this.opts;var m=j.selectedData;for(var n=m.length-1;n>=0;n--){var l=m[n];if(l.id==o.id){m.remove(n)}}k.showResult()},clearData:function(){this.opts.selectedData=[];this.elem.find(".selectResult").empty()},getData:function(){return this.opts.selectedData},getDataCount:function(){return this.getData().length},getDataID:function(){var l=[];var j=this.getData();for(var k=0;k<j.length;k++){var m=j[k];l.push(m.id)}return l},getLevel2Value:function(p){var l=this;var k=this.opts;for(var m=0;m<k.data.length;m++){var o=k.data[m];for(var n=0;n<o.children.length;n++){var q=o.children[n];if(q.id==p){return o}}}return null},getLevel2:function(){var j=this;var n=j.getData();var m=[];for(var k=0;k<n.length;k++){var l=n[k];var o=j.getLevel2Value(l.id);if(c(o,m)){continue}if(o!=null){m.push(o)}}return m},setValue:function(j){var i=this;i.clearData();if(i.isExists(j)){return}var k=i.findDataItem(j);if(k!=null){i.appendData(k)}},setValues:function(k){var j=this;j.clearData();if($.type(k)=="array"){var n=[];for(var l=0;l<k.length;l++){var m=k[l];if(j.isExists(m)){return}var o=j.findDataItem(m);if(o!=null){n.push(o)}}if(n.length>0){for(var l=0;l<n.length;l++){var m=n[l];j.appendData(m)}}}},findDataItem:function(p){var k=this;var j=this.opts;if(j.level==1){return k.findInArray(p,j.data)}else{for(var m=0;m<j.data.length;m++){var n=j.data[m];var l=n.children;var o=k.findInArray(p,l);if(o!=null){return o}}}return null},findInArray:function(m,j){if(!j){return null}for(var k=0;k<j.length;k++){var l=j[k];if(l.id==m){return l}}return null},isExists:function(m){var k=this.opts.selectedData;for(var l=0;l<k.length;l++){var j=k[l];if(m.id==j.id){return true}}return false},showResult:function(){var l=this;var k=this.opts;var t=this.elem.find(".selectResult");t.removeClass("placeHolder");var m=k.selectedData;t.text("");var v=[];if(k.allLevelSelect==true||k.showAllName==false||k.level==1||k.level==3){for(var n=0;n<m.length;n++){var o=m[n];var w=o.text;if($.type(w)==="string"){w=w.replace("，","")}v.push(w)}t.html(v.join("，"))}else{if(k.level==2){var q=l.getLevel2();var s=[];for(var n=0;n<q.length;n++){var r=q[n];var u='<span class="parentName">'+r.text+"</span>：";var y=[];for(var p=0;p<r.children.length;p++){var x=r.children[p];if(l.isExists(x)){y.push(x.text)}}u+=y.join(" ");s.push(u)}t.html(s.join("，"))}}},showPanel:function(){var i=this;var k=i.createContainer();k.fadeIn("fast");i.setPanelSite();var j=k.offset().top;var m=$(window).height();if(j>m){scrollHelper.scrollTop(j-40)}k.find(".selectBoxItem").each(function(){var o=$(this);var n={id:o.attr("data-id"),text:o.text()};if(i.isExists(n)){o.addClass("selected")}});i.elem.addClass("selectBoxFocus");if(i.opts.levelTwoSelect){var l=k.find(".selectTopItem");l.addClass("topItemEnable").attr("title","全选/反选");l.click(function(){var p=$(this);var o=p.parents(".secondLine");var n=o.find(".selectBoxItem");if(n.length==o.find(".selected").length){n.addClass("selected")}else{n.removeClass("selected")}n.trigger("click")})}},destroyPanel:function(){var j=this;var i=this.opts;var k=$(".selectBoxConter");k.fadeOut("fast",function(){var l=j.getDataID();if(i.valueTarget.length>0){$("#"+i.valueTarget).val(l)}i.onClose(j.getData(),l);k.remove()});j.elem.removeClass("selectBoxFocus");j.showPlaceHolder();$(window.document).off("click",{obj:j},a)}};function a(i){i.data.obj.destroyPanel()}function d(){return e("clear")}function e(i){var j=$("<div />");j.addClass(i);return j}$.fn.selectBox=function(j){var i=new g(this,j);i.init();return i}})();